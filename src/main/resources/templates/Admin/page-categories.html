<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Game Fusion - Dashboard - Category management</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/assets/admin-assets/imgs/theme/favicon.svg}">
    <link th:href="@{/assets/admin-assets/css/main.css}" rel="stylesheet" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <style>
        .container { display: flex; flex-direction: column;}
        .row { display: flex;}
        .column {flex: 1; padding: 10px; text-align: center;}
    </style>
    <script>
        function confirmActivate(form) {
            Swal.fire({
                title: 'Are you sure?',
                text: 'Do you want to Activate this category?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes', // Removed the extra comma
                cancelButtonText: 'No, cancel',
            }).then((result) => {
                if (result.isConfirmed) {
                    // If the user confirms, submit the form
                    form.submit();
                }
            });
        }
        function confirmDeactivate(form) {
            Swal.fire({
                title: 'Are you sure?',
                text: 'Do you want to De-Activate this category?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                cancelButtonText: 'No, cancel',
            }).then((result) => {
                if (result.isConfirmed) {
                    // If the user confirms, submit the form
                    form.submit();
                }
            });
        }
    </script>
</head>
<body>
<div class="screen-overlay"></div>
<aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
        <a href="#" class="brand-wrap">
            <img th:src="@{/assets/admin-assets/imgs/theme/New-logo.svg}" class="logo" alt="Evara Dashboard">
        </a>
        <div>
            <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>

        </div>
    </div>
    <nav>
        <ul class="menu-aside">
            <li class="menu-item">
                <a class="menu-link" th:href="@{/dashboard}">
                    <i class="icon material-icons md-home"></i><span class="text">Dashboard</span>
                </a>
            </li>
            <li class="menu-item ">
                <a class="menu-link" th:href="@{/dashboard/view-products}">
                    <i class="icon material-icons md-shopping_bag"></i><span class="text">Products</span>
                </a>
            </li>
            <li class="menu-item ">
                <a class="menu-link" th:href="@{/dashboard/view-users}">
                    <i class="icon material-icons md-person"></i><span class="text">Users</span>
                </a>
            </li>
            <li class="menu-item ">
                <a class="menu-link" href="#">
                    <i class="icon material-icons md-store"></i><span class="text">Sellers</span>
                </a>
            </li>
            <li class="menu-item  active">
                <a class="menu-link" href="#">
                    <i class="icon material-icons md-add_box"></i><span class="text">Categories</span>
                </a>
            </li>
            <li class="menu-item ">
                <a class="menu-link" href="#">
                    <i class="icon material-icons md-shopping_cart md-monetization_on"></i><span class="text">Orders</span>
                </a>
            </li>
            <li class="menu-item ">
                <a class="menu-link" href="#">
                    <i class="icon material-icons md-pie_chart"></i><span class="text">Sales Report</span>
                </a>
            </li>
        </ul>
    </nav>
</aside>`
<main class="main-wrap">
    <header class="main-header navbar">
        <div class="col-search">
            <form class="searchform">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search term">
                    <button class="btn btn-light bg" type="button"><i class="material-icons md-search"></i></button>
                </div>
            </form>
        </div>
        <div class="col-nav">
            <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
                    class="material-icons md-apps"></i></button>
            <ul class="nav">
                <li class="nav-item">
                    <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i> </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="requestfullscreen nav-link btn-icon"><i class="material-icons md-cast"></i></a>
                </li>
                <li class="dropdown nav-item">
                    <!--Profile -->
                    <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                       aria-expanded="false"> <img class="img-xs rounded-circle"
                                                   th:src="@{/assets/admin-assets/imgs/people/avatar-2-admin.png}"
                                                   alt="User"></a>
                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                        <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit
                            Profile</a>
                        <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Change Password</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-danger" href="#"><i class="material-icons md-exit_to_app"></i>Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <section class="content-main">
        <div class="content-header">
            <div>
                <h2 class="content-title card-title">Categories </h2>
                <p>Add, edit or delete a category</p>
            </div>
            <div>
                <a type="button" class="btn btn btn-primary" th:href="@{/dashboard/add-category}">Create</a>
            </div>
        </div>
        <div th:if="${CategoryList.contents == null or CategoryList.contents.size() == 0}">
            <h3>No Category found in the database.</h3>
        </div>
        <div class="card" th:if="${CategoryList.contents != null}" >
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Parent-ID</th>
                                    <th class="text-end">Action</th>
                                    <th class="text-end"></th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Loop Start -->
                                <tr th:each="category : ${CategoryList.contents}">
                                    <td></td>
                                    <td><h4 th:text="${category.id}"></h4></td>
                                    <td><h4 th:text="${category.name}"></h4></td>
                                    <td>
                                        <form th:method="PUT"
                                              th:action="@{/dashboard/update-status/{categoryId}(categoryId=${category.id})}" onsubmit="return false;">
                                            <button type="submit" class="rounded-pill alert-success"
                                                    th:if="${category.status}" onclick="confirmDeactivate(this.form)">Active</button>
                                            <button type="submit" class="rounded-pill alert-danger"
                                                    th:if="${!category.status}" onclick="confirmActivate(this.form)">
                                                InActive</button>
                                        </form>
                                    </td>
                                    <td>
                                        <h4 th:id="'parentName_' + ${category.id}"></h4>
                                        <script th:inline="javascript">
                                            /* JavaScript to make an AJAX request and update the parentName */
                                            $(document).ready(function() {
                                                var categoryId = [[${category.id}]];
                                                var parentId = [[${category.parentId}]];
                                                $.ajax({
                                                    url: '/dashboard/get-category/' + parentId,
                                                    type: 'GET',
                                                    success: function(response) {
                                                        $('#parentName_' + categoryId).text(response);
                                                    },
                                                    error: function(xhr, status, error) {
                                                        console.log("Error: " + status + " - " + error);
                                                    }
                                                });
                                            });
                                        </script>
                                    </td>


                                    <td class="text-end">
                                        <a class="btn btn btn-primary" th:href="@{/dashboard/edit-category/{categoryId}(categoryId=${category.id})}">
                                            Edit info</a>
                                    </td>
                                    <td></td>
                                </tr>
                                <!-- Loop End -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Pagination -->
                <div class="pagination-area mt-30 mb-50">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-start">
                            <li class="page-item" th:each="page, iterStat : ${#numbers.sequence(0, CategoryList.totalPages - 1)}"
                                th:class="${page == CategoryList.pageNo} ? 'page-item active' : 'page-item'">
                                <a class="page-link" th:href="@{/dashboard/view-categories(pageNo=${page},pageSize=${CategoryList.pageSize})}"
                                   th:text="${page + 1}"></a>
                            </li>
                            <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                            <li class="page-item">
                                <a class="page-link" th:if="${CategoryList.hasNext}"
                                   th:href="@{/dashboard/view-categories(pageNo=${CategoryList.totalPages - 1},pageSize=${CategoryList.pageSize})}">
                                    <i class="material-icons md-chevron_right"></i>
                                </a>
                            </li>

                        </ul>
                    </nav>
                </div>
                <!-- End of pagination -->
            </div>
        </div>
    </section>
</main>
<script th:src="@{/assets/admin-assets/js/vendors/jquery-3.6.0.min.js}"></script>
<script th:src="@{/assets/admin-assets/js/vendors/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/admin-assets/js/vendors/select2.min.js}"></script>
<script th:src="@{/assets/admin-assets/js/vendors/perfect-scrollbar.js}"></script>
<script th:src="@{/assets/admin-assets/js/vendors/jquery.fullscreen.min.js}"></script>
<script th:src="@{/assets/admin-assets/js/main.js}" type="text/javascript"></script>
</body>
</html>